#!/bin/sh

if [ "x$EDITOR" = "x" ]; then
	EDITOR=vi
fi

if [ $# != 1 ]; then
    echo "Usage: ./password <server>  --- prints out the entry containg the string server"
    echo "Usage: ./password --dump    --- prints the password file to stdout"
    echo "Usage: ./password --edit    --- edit the password file"
    echo "You will be prompted for the password"
    exit
fi

f=`openssl bf-cfb -d -in passwords.txt.bf`

if [ "$1" = "--dump" ]; then
    echo "$f"
elif [ "$1" = "--edit" ]; then
	echo "$f" > tmp
	$EDITOR tmp
	if [ $? = 0 ]; then
		openssl bf-cfb -e -in tmp -out passwords.txt.bf
		if [ $? = 0 ]; then
			rm tmp
		fi
	fi
else
    echo "$f" | awk -v server=$1 'BEGIN{RS=""} {if($0 ~ server){print $0}}'
fi
